<!doctype html>
<html>
  <head>
    <title>Tine-lunsj!</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
		body {
			max-width: 650px;
			margin-left: 10px;
			margin-top: 10px;
		}
    </style>
  </head>
  <body>
        <form role="form" id="menu-form">
            <fieldset>
                <legend>Legge til ny, endre eller slette rett i meny:</legend>
                <div id="loader">
                    <span class="glyphicon glyphicon-refresh spinning"></span>
                </div>
                <div id="content">
                    <div class="form-group">
                        <label for="oldname">Eksisterende meny (velg for retting eller sletting):</label>
                        <select class="form-control" id="oldname" name="oldname">
                            <option value="" disabled selected>-</option>
                        </select>
                    </div>
                    <input type="hidden" class="form-control" id="key" name="key" placeholder="">
                    <div class="form-group">
                        <label for="newname">Nytt navn:</label>
                        <input type="text" class="form-control" id="newname" name="newname" value= "" placeholder="Stekte nudler med biff (Stor)">
                    </div>
                    <div class="form-group">
                        <label for="newprice">Ny Pris:</label>
                        <input type="text" class="form-control" id="newprice" name="newprice" value= "" placeholder="59">
                    </div>
                </div>
                <button type="button" id="post-button" class="btn btn-default">Legg til!</button> <button type="button" id="put-button" class="btn btn-default">Endre!</button> <button type="button" id="delete-button" class="btn btn-default">Slett!</button>
                <br/><br/>
                <legend>I'm done:</legend>
                <a href="/tine-lunsj" class="btn btn-default">Tilbake</a>
            </fieldset>
        </form>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script>
      $(document).ready(function() {
          $.get("/tine-lunsj/menuItems", function(data) {
              data.sort(function(a, b){
                  var x = a.name.toLowerCase();
                  var y = b.name.toLowerCase();
                  return ((x < y) ? -1 : ((x > y) ? 1 : 0));
              });
              for(var i = 0; i < data.length; i++) {
                  var item = data[i];
                  $("#oldname").append("<option data-name='" + item.name + "' data-price='" + item.price + "' data-key='" + item.key + "'>" + item.name + " - " + item.price + " kr" + "</option>");

              }
              $("#loader").hide();
              $("#content").show();
          });

          $("#oldname").change(function() {
              var price = $("#oldname").find("option:selected").data("price");
              var key = $("#oldname").find("option:selected").data("key");
              var name = $("#oldname").find("option:selected").data("name");
              $("#newprice").val(price);
              $("#newname").val(name);
              $("#key").val(key);
          });
      });

      $("#post-button").on('click',xhrSend('POST'));
      $("#put-button").on('click',xhrSend('PUT'));
      $("#delete-button").on('click',xhrSend('DELETE'));

      function xhrSend(method) {
          return function() {
              var xhr = new XMLHttpRequest();
              xhr.onload = function () {
                  if (xhr.status == 200) {
                      location.href = "/menuItemSuccess.html";
                  } else location.href = "/menuItemFailure.html";
              };
              xhr.open(method, '/tine-lunsj/menuItem', true);
              var data = new FormData($("#menu-form")[0]);
              xhr.send(data);
          }
      }
    </script>
</html>